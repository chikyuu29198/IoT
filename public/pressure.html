<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Visualize Pressure</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="keywords">
  <meta content="" name="description">

  <!-- Favicons -->
  <link href="img/visualizeIcon.jpg" rel="visualizeIcon">
  <link href="img/visualizeIcon.jpg" rel="visualizeIcon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,600,700,700i|Montserrat:300,400,500,600,700" rel="stylesheet">

  <!-- Bootstrap CSS File -->
  <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Libraries CSS Files -->
  <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="lib/animate/animate.min.css" rel="stylesheet">
  <link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
  <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

  <style>
    canvas {
      margin: 0 auto;
      /* width: 800px !important;
      height: 500px !important; */
      background: #fff;
    }
  </style>
</head>

<body>

    <canvas id="chart3"></canvas> 
  <!-- Uncomment below i you want to use a preloader -->
  <!-- <div id="preloader"></div> -->

  <!-- JavaScript Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>
  <script src="lib/jquery/jquery.min.js"></script>
  <script src="lib/jquery/jquery-migrate.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/mobile-nav/mobile-nav.js"></script>
  <script src="lib/wow/wow.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/counterup/counterup.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="lib/isotope/isotope.pkgd.min.js"></script>
  <script src="lib/lightbox/js/lightbox.min.js"></script>
  <!-- Contact Form JavaScript File -->
  <script src="contactform/contactform.js"></script>

  <!-- Template Main Javascript File -->
  <script src="js/main.js"></script>
  <script defer src="/__/firebase/7.5.0/firebase-app.js"></script>
  <script defer src="/__/firebase/7.5.0/firebase-database.js"></script>
  <script defer src="/__/firebase/init.js"></script>

  <!-- <script src="js/drawplot.js"></script> -->

<script>
  document.addEventListener('DOMContentLoaded', function() {
  
  firebase.database().ref('/').limitToLast(50).on('value', snapshot => {
    // updateStarCount(postElement, snapshot.val());
    var formattedTime;
    var latest_update;
    let data = snapshot.val();
    
    let arr1 = []; 
    let arr2 = []; 
    let time = [];
    let humidity = [];
    let pressure = [];
    Object.keys(data).forEach((key) => {
      var a = new Date(data[key].time*1000);
      var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      var year = a.getFullYear();
      var month = months[a.getMonth()];
      var date = a.getDate();
      var hour = a.getHours();
      var min = a.getMinutes();
      var sec = a.getSeconds();
      formattedTime = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec ;

      arr1.push(data[key].bmp.temp);
      arr2.push(data[key].dht.temp);
      humidity.push(data[key].dht.hum);
      pressure.push(data[key].bmp.press);
      time.push(formattedTime);

      // latest_update = "Latest update data: " + formattedTime;
      
    });

// document.getElementById("latest").innerHTML= latest_update;

    let chartConfig3 = {
      type: 'line',
      data: {
        labels: time,
        datasets: [{
          label: 'GY68 - BMP180',
          backgroundColor: 'red',
          borderColor: 'red',
          data: pressure,
          fill: false,
        }]
      },
      options: {
        responsive: true,
        
        title: {
          display: true,
          text: 'Pressure Line Chart'
        },
        tooltips: {
          mode: 'index',
          intersect: false,
        },
        hover: {
          mode: 'nearest',
          intersect: true
        },
        scales: {
          xAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Time'
            }
          }],
          yAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Pa '
            }
          }]
        }
      }
    }; 

    let ctx3 = document.getElementById("chart3").getContext('2d');
    let chart3 = new Chart(ctx3, chartConfig3);
 
  });
});
</script>
</body>
</html>
